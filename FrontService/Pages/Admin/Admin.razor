@page "/admin"
@using Microsoft.AspNetCore.Authorization
@using MudBlazor
@using MudBlazor.Components
@inherits LayoutComponentBase
@attribute [Authorize(Roles = "admin")]
@using Microsoft.AspNetCore.Components.Authorization
@inject NavigationManager Nav
@inject AuthenticationStateProvider Auth

<MudLayout>
    <MudAppBar Elevation="1" Color="Color.Primary" Dense="true" Class="appbar-fixed">
        <MudText Typo="Typo.h6" Class="ms-3">Админ-панель</MudText>
        <MudSpacer />
        <MudButton StartIcon="@Icons.Material.Filled.Logout" Color="Color.Secondary"
                   Variant="Variant.Outlined" Class="me-4" OnClick="Logout"> Выход
        </MudButton>
    </MudAppBar>

    <MudDrawer Open="true" Variant="DrawerVariant.Persistent" Elevation="1"
               Class="drawer-fixed" Width="250px">

        <MudText Typo="Typo.h6" Class="mt-3 mb-3 ms-2">Разделы</MudText>
        <MudStack Spacing="1" Class="ms-2 me-2">
            <MudButton Href="/admin/users" Variant="Variant.Outlined"
                       Color="Color.Primary" Style="justify-content:flex-start"> Управление пользователями
            </MudButton>

            <MudButton Href="/admin/system" Variant="Variant.Outlined"
                       Color="Color.Primary" Style="justify-content:flex-start"> Система
            </MudButton>

            <MudButton Href="/admin/reports" Variant="Variant.Outlined"
                       Color="Color.Primary" Style="justify-content:flex-start"> Отчёты
            </MudButton>
        </MudStack>
    </MudDrawer>


    <MudMainContent Class="main-content-fix pa-4">
        <MudPaper Elevation="2" Class="pa-6" Style="height:100%; min-height:700px;">
            @Body
        </MudPaper>
    </MudMainContent>

</MudLayout>

<style>
    .appbar-fixed {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1200;
    }

    .drawer-fixed {
        position: fixed;
        top: 48px;
        left: 0;
        bottom: 0;
        overflow-y: auto;
    }

    .main-content-fix {
        margin-top: 60px;
        margin-left: 250px;
    }
</style>

@code {
    private async Task Logout()
    {
        await ((CustomAuthStateProvider)Auth).Logout();
        Nav.NavigateTo("/login", true);
    }
}